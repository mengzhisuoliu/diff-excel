# Excel文件对比工具 (Diff Excel)

一个功能强大的Excel文件对比工具，支持单Sheet和多Sheet对比，保持原文件格式的同时高亮差异内容。

A powerful Excel file comparison tool that supports both single-sheet and multi-sheet comparison while maintaining the original file format and highlighting differences.

## 🚀 功能特性

### 核心功能
- **Excel文件对比**：支持对比两个Excel文件的差异
- **多Sheet对比**：支持同时对比多个Sheet，一对一映射
- **灵活Sheet对比**（新功能）：支持手动选择多对Sheet进行对比，任意搭配
- **格式保持**：可选择保持原始文件的完整格式（单元格大小、合并单元格、字体样式等）
- **差异高亮**：使用颜色高亮显示不同的单元格
- **备注功能**：可在差异单元格中添加备注显示原始内容
- **自定义颜色**：支持自定义差异高亮颜色
- **多种输出**：生成对比后的Excel文件和详细日志文件

### 技术特点
- **模块化架构**：清晰的文件结构，易于维护和扩展
- **GUI界面**：基于Fyne框架的直观用户界面
- **跨平台**：支持Windows、macOS、Linux
- **高性能**：支持大型Excel文件处理

## 📋 快速开始

### 安装和运行

```bash
# 1. 克隆项目
git clone <repository-url>
cd diff_excel

# 2. 下载依赖
go mod tidy

# 3. 运行应用程序（推荐方式）
go run .

# 或者编译后运行
go build -o diff_excel
./diff_excel  # Linux/macOS
# 或 diff_excel.exe  # Windows
```

### 基本使用步骤

1. **选择文件**：
   - 点击"上传"按钮选择原始Excel文件
   - 点击"上传"按钮选择对比Excel文件

2. **选择Sheet**：
   - 单Sheet模式：从下拉菜单选择要对比的工作表
   - 灵活Sheet对比（新功能）：在"灵活多Sheet对比"区域手动选择和添加多对Sheet进行对比
   - 多Sheet模式：勾选"多Sheet对比模式"，然后选择多个Sheet进行一对一映射

3. **配置选项**：
   - 选择输出目录
   - 设置高亮颜色
   - 选择是否显示备注
   - 选择是否保持原文件格式

4. **开始对比**：
   - 点击"开始对比"按钮
   - 等待处理完成
   - 查看生成的Excel文件和日志文件

## 🚀 新功能：灵活多Sheet对比

### 功能特点
- 手动选择任意多对Sheet进行对比
- 不受一对一映射限制，可以自由搭配
- 结果文件中的Sheet名称自动生成为“源文件Sheet名 + 对比 + 对比文件Sheet名”格式
- 支持动态添加和删除对比对

### 使用方法
1. 上传两个Excel文件
2. 在“灵活多Sheet对比”区域：
   - 从左侧下拉框选择源文件的Sheet
   - 从中间下拉框选择对比文件的Sheet
   - 点击“添加Sheet对比对”按钮
3. 重复步骤2添加更多对比对
4. 在对比对列表中可以查看和删除已添加的对比对
5. 点击“开始对比”按钮

### 示例
如果你有两个文件：
- 源文件：`数据.xlsx` （包含Sheet：“销售数据”、“库存数据”）
- 对比文件：`更新数据.xlsx` （包含Sheet：“新销售”、“新库存”）

你可以创建以下对比对：
- 销售数据 对比 新销售
- 库存数据 对比 新库存

最终结果文件将包含两个Sheet：
- “销售数据 对比 新销售”
- “库存数据 对比 新库存”

## 🔧 详细功能说明

### 格式保持功能

#### 两种对比模式

**普通模式（不保持格式）**：
- 创建全新的Excel文件
- 只包含数据内容
- 所有单元格使用默认格式
- 差异单元格添加背景色高亮

**格式保持模式**：
- 复制原始文件作为基础
- 保持所有原始格式设置：
  - 单元格宽度和高度
  - 合并单元格
  - 字体样式、大小、颜色
  - 边框样式
  - 其他所有格式设置
- 只修改有差异的单元格：
  - 更新内容为新值
  - 添加背景色高亮
  - 可选添加备注显示原始内容

#### 使用场景

**格式保持模式特别适用于**：
- 表格结构复杂，有大量格式设置的文件
- 需要保持原有视觉效果的报表对比
- 有合并单元格的表格
- 包含图表、图片等复杂元素的文件
- 需要将对比结果给其他人查看，希望保持原有外观

**普通模式适用于**：
- 简单的数据对比
- 只关心内容差异，不在意格式
- 需要生成干净简洁的对比结果

### 多Sheet对比功能

#### 功能亮点
- **一对一映射**：每个源Sheet对应一个目标Sheet
- **批量处理**：可同时对比多个Sheet，大幅提高效率
- **统一输出**：所有对比结果保存在同一个输出文件中
- **详细日志**：日志文件包含所有Sheet的差异详情
- **格式兼容**：多Sheet模式同样支持格式保持功能

#### 使用场景
- **多部门数据报表对比**：财务、销售、运营等多个部门的数据表一次性对比
- **不同时期数据对比**：月度、季度、年度报表的历史版本对比
- **复杂Excel文件处理**：包含多个工作表的大型Excel文件批量对比
- **版本变更跟踪**：多个工作表的历史版本对比分析

#### 映射示例
```
源文件Sheet1    →  目标文件Sheet1
源文件数据表    →  目标文件Data  
源文件财务报告  →  目标文件Finance
源文件销售数据  →  目标文件Sales
```

#### 输出格式

**Excel输出文件**：
```
差异文件_2024.01.01_12_30_45.xlsx
├── Sheet1 (对比结果)
├── 数据表 (对比结果)
├── 财务报告 (对比结果)
└── 销售数据 (对比结果)
```

**日志文件格式**：
```
=== Sheet: Sheet1 ===
[Sheet1] A1: 旧值 → 新值
[Sheet1] B2: 旧值 → 新值

=== Sheet: 数据表 ===
[数据表] C3: 旧值 → 新값
[数据表] D4: 旧값 → 新값

总差异数：4
```

## 🏗️ 项目架构

### 文件结构

```
diff_excel/
├── main.go (12行)           # 程序入口点
├── app.go (169行)           # 应用程序核心逻辑和结构体定义
├── ui.go (414行)            # UI组件和界面布局管理
├── compare.go (380行)       # Excel对比核心算法
├── main_test.go             # 单元测试
├── testdata/                # 测试数据
├── utils/                   # 工具函数包
│   ├── file_utils.go        # 文件操作工具
│   ├── ui_utils.go          # UI工具函数
│   ├── excel.go             # Excel相关工具
│   └── utils.go             # 通用工具函数
├── go.mod                   # Go模块定义
└── README.md                # 项目文档
```

### 模块化设计优势

1. **职责分离**：每个文件承担特定职责，提高代码可维护性
2. **工具函数统一管理**：utils包按功能类型组织工具函数
3. **UI逻辑分离**：ui.go专门处理界面相关逻辑
4. **核心算法独立**：compare.go包含所有Excel对比算法
5. **易于扩展**：模块化结构便于后续功能扩展

### 核心组件

- **ExcelCompareApp**：主应用程序结构体，管理所有状态和配置
- **CompareExcelFiles()**：单Sheet对比核心算法
- **CompareMultipleSheets()**：多Sheet对比核心算法
- **UI组件**：基于Fyne框架的用户界面组件
- **工具函数**：文件操作、Excel处理、UI辅助等工具函数

## 🔧 开发说明

### 技术栈
- **Go语言**：主要开发语言
- **Fyne**：GUI框架
- **excelize**：Excel文件处理库
- **Go Modules**：依赖管理

### 运行要求
- Go 1.19+
- 支持GUI的操作系统环境

### 运行方式

根据Go项目运行规范，项目重构为多文件后，请使用以下方式运行：

```bash
# ✅ 推荐：运行整个包
go run .

# ✅ 编译后运行
go build && ./diff_excel

# ✅ 编译到指定名称
go build -o excel_compare && ./excel_compare

# ❌ 不推荐：单文件运行（会导致函数未定义错误）
go run main.go
```

### 测试

```bash
# 运行单元测试
go test

# 运行详细测试
go test -v

# 测试覆盖率
go test -cover
```

## 💡 使用技巧

### 性能优化建议
1. **大文件处理**：对于大型Excel文件，建议在性能较好的机器上运行
2. **内存使用**：格式保持模式会使用更多内存，请确保有足够可用内存
3. **批量处理**：使用多Sheet模式可以大幅提高批量对比的效率

### 最佳实践
1. **备份重要文件**：重要文件建议先备份再进行对比操作
2. **文件权限**：确保有读取源文件和写入输出目录的权限
3. **输出目录**：选择有足够空间的输出目录
4. **颜色选择**：选择对比度较高的颜色以便更好地识别差异

### 常见问题

**Q: 为什么运行`go run main.go`会报错？**  
A: 项目重构为多文件结构后，需要使用`go run .`运行整个包，而不是单个文件。

**Q: 多Sheet对比时如何确定映射关系？**  
A: 按选择顺序进行一对一映射，第一个选中的源Sheet对应第一个选中的目标Sheet。

**Q: 格式保持模式适用于所有Excel文件吗？**  
A: 适用于大多数Excel文件，但对于包含复杂宏或特殊格式的文件可能有限制。

**Q: 支持哪些Excel文件格式？**  
A: 主要支持.xlsx格式，这是现代Excel的标准格式。

## 📈 项目发展历程

### 已实现功能
- ✅ 单Sheet对比功能
- ✅ 多Sheet对比功能  
- ✅ 格式保持功能
- ✅ GUI用户界面
- ✅ 模块化代码结构
- ✅ 工具函数统一管理
- ✅ 跨平台支持
- ✅ 单元测试

### 技术改进
- ✅ 代码重构：从928行单文件重构为模块化结构
- ✅ 架构优化：职责分离，提升可维护性
- ✅ 运行优化：解决main函数冲突，规范运行方式
- ✅ 文档完善：提供详细的使用说明和开发文档

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

### 开发环境设置
1. Fork这个项目
2. 创建特性分支：`git checkout -b feature/your-feature`
3. 提交更改：`git commit -am 'Add some feature'`
4. 推送分支：`git push origin feature/your-feature`
5. 创建Pull Request

### 代码规范
- 遵循Go语言官方代码规范
- 每个公共函数都需要有文档注释
- 重要功能需要添加单元测试
- 保持模块化的代码结构

## 📄 许可证

本项目采用MIT许可证 - 详见 [LICENSE](LICENSE) 文件

## ⭐ 致谢

感谢以下开源项目：
- [Fyne](https://fyne.io/) - Go语言GUI框架
- [excelize](https://github.com/qax-os/excelize) - Go语言Excel处理库

---

如果这个项目对您有帮助，请给个⭐️支持一下！